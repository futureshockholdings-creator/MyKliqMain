version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm install --force
    build:
      commands:
        - rm -rf dist
        - echo "VITE_API_BASE_URL=$VITE_API_BASE_URL" >> .env
        - npm run build
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths: []
  redirects:
    # Serve all static files with their extensions directly
    - source: /<*>.js
      target: /<*>.js
      status: 200
      condition: null

    - source: /<*>.css
      target: /<*>.css
      status: 200
      condition: null

    - source: /<*>.json
      target: /<*>.json
      status: 200
      condition: null

    - source: /<*>.png
      target: /<*>.png
      status: 200
      condition: null

    - source: /<*>.jpg
      target: /<*>.jpg
      status: 200
      condition: null

    - source: /<*>.ico
      target: /<*>.ico
      status: 200
      condition: null

    - source: /<*>.svg
      target: /<*>.svg
      status: 200
      condition: null

    - source: /<*>.woff
      target: /<*>.woff
      status: 200
      condition: null

    - source: /<*>.woff2
      target: /<*>.woff2
      status: 200
      condition: null

    - source: /icons/<*>
      target: /icons/<*>
      status: 200
      condition: null

    - source: /screenshots/<*>
      target: /screenshots/<*>
      status: 200
      condition: null

    - source: /assets/<*>
      target: /assets/<*>
      status: 200
      condition: null

    - source: /firebase-sw/<*>
      target: /firebase-sw/<*>
      status: 200
      condition: null

    # SPA fallback for the rest of your routes (non-file paths)
    - source: /<*>
      target: /index.html
      status: 200
      condition: null
